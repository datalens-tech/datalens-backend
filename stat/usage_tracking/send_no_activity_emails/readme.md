# Send no-activity emals

Скрипт используется в качестве Sandbox-ресурса, запускаемого кубиком в нирване.

Параметры запуска (таблица с пользователями и параметры отправки) передаются в виде аргументов командной строки.

Скрипт фильтрует пользователей, которые давно не заходили в даталенс, и отправляет им соответствующее письмо через [notify](https://a.yandex-team.ru/arcadia/data-ui/notify/docs/api.md#post-/v1/send). Для успешных отправок в исходной таблице делаются пометки, чтобы не отправлять письмо по нескольку раз.

Входная таблица генерируется соседним процессом `../update_users_activity`.

## Nirvana & Sandbox

Тип ресурса: DATALENS_SEND_NO_ACTIVITY_EMAILS ([файл с классом Sandbox-ресурса](https://arcanum.yandex-team.ru/arc_vcs/sandbox/projects/datalens/resources/__init__.py))

Материалы в нирване: [реакция](https://reactor.yandex-team.ru/browse?selected=13268809), [кубик](https://nirvana.yandex-team.ru/operation/0bacc45f-5fcb-4986-94c8-9998c1bdf9a3), [артефакт для запуска](https://reactor.yandex-team.ru/browse?selected=13268920).

Реакция запускается по следующему принципу:
1. Первичный триггер - крон на 9 часов утра;
2. Вторичный триггер - артефакт: реакция запускается только если он имеет значение `true`. После успешного запуска реакция сбрасывает его значение в `false`, обратно в `true` его выставляет реакция для `../update_users_activity`.

Таким образом, условие запуска можно интерпретировать как "запускайся в 9 часов утра, если с последнего запуска произошло изменение таблицы активности пользователей".
