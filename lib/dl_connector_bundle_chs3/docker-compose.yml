version: '3.7'

x-constants:
  US_MASTER_TOKEN: &c-us-master-token "AC1ofiek8coB"
  REDIS_PASSWORD: &c-redis-password "AwockEuvavDyinmeakmiRiopanbesBepsensUrdIz5"


services:
  redis:
    image: "bitnami/redis:5.0.8@sha256:3127620da977815556439a9dc347fff89432a79b6bb6e93a16f20ac4a34ce337"
    environment:
      REDIS_PASSWORD: *c-redis-password
    ports:
      - 52604:6379

  db-clickhouse:
    build:
      context: docker-compose
      dockerfile: Dockerfile.db-clickhouse-22-10
    ports:
      - 52610:8123
      - 52611:9000

  s3-storage:
    build:
      context: ../testenv-common/images
      dockerfile: Dockerfile.s3-storage
    command: bash /data/entrypoint.sh
    environment:
      S3BACKEND: "mem"
      REMOTE_MANAGEMENT_DISABLE: 1
    ports:
      - 52620:8000

  pg-us:
    extends:
      file: ../testenv-common/docker-compose.common.yml
      service: pg-us
    ports:
      - 52609:5432

  us:
    extends:
      file: ../testenv-common/docker-compose.common.yml
      service: us
    ports:
      - 52600:8083
