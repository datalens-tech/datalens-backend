version: '3'

vars:
  USER_REL_PATH:
    sh: python3 -c "import os,sys;print(os.path.relpath('{{.USER_WORKING_DIR}}'))"

  ROOT_DIR:
    sh: pwd


includes:
  env:
    taskfile: tools/taskfiles/taskfile_env.yml
    dir: tools
    optional: true

  gen:
    taskfile: tools/taskfiles/taskfile_gen.yml
    dir: tools
    optional: true

  release:
    taskfile: tools/taskfiles/taskfile_release.yaml
    dir: tools
    optional: true

  e2e:
    taskfile: tools/e2e/Taskfile.yaml
    dir: tools/e2e
    optional: true

  dev:
    taskfile: tools/taskfiles/taskfile_dev.yml
    optional: true
    vars:
      PROJECT_ROOT_PATH: '{{.ROOT_DIR}}'
      PYPROJECT_TOML_PATH: '{{.ROOT_DIR}}/metapkg/pyproject.toml'
      METAPKG_DIR: '{{.ROOT_DIR}}/metapkg'
      DEFAULT_VENV_PATH: '{{.ROOT_DIR}}/metapkg/.venv'
      LINTERS_PYPROJECT_TOML_PATH: '{{.ROOT_DIR}}/pyproject.toml'
      EXCLUDE_LIB_PATHS: |
        {{.ROOT_DIR}}
        {{.ROOT_DIR}}/metapkg
        {{.ROOT_DIR}}/terrarium/bi_ci/bi_ci_tests/unit/resources
        {{.ROOT_DIR}}/terrarium/dl_repmanager
        {{.ROOT_DIR}}/tools/cookiecutter/templates/.*
      EXCLUDE_TOML_SORT: |
        {{.ROOT_DIR}}/tools/cookiecutter/templates/.*
      EXCLUDE_SORT_ALL: |
        {{.ROOT_DIR}}/tools/cookiecutter/templates/.*
        {{.ROOT_DIR}}/metapkg/.*
        {{.ROOT_DIR}}/terrarium/dl_repmanager/.venv/.*
      PARENT_BRANCH: '{{.PARENT_BRANCH | default "main"}}'

  cc:
    taskfile: tools/cookiecutter/Taskfile.yaml
    optional: true
    vars:
      VENV_PATH: '{{.ROOT_DIR}}/metapkg/.venv'
      PROJECT_ROOT_PATH: '{{.ROOT_DIR}}'
      METAPKG_FILE: '{{.ROOT_DIR}}/metapkg/pyproject.toml'
  ops:
    taskfile: tools/taskfiles/taskfile_ops.yml
    dir: tools
    optional: true
