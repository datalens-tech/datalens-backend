## Утилита для подключения кластера материализации

На всех шагах можно проверить, что утилита собирается делать, для этого есть ключ `--dry-run` - с ним в консоль выведется то, что собирается сделать утилита, но реально эти действия проделаны не будут

### Шаг 1 - Создание баз и пользователей к ним
```bash
./mat_ch_cluster_population make-dbs ...
```
Принимает входными параметрами данные кластера ClickHouse и секрет+ключ пароля от пользователя этого кластера в секретнице YaV

Создаёт базы и пользователей в кластере, в выходной файл сохраняет созданные базы с пользователями и их паролями.

### Шаг 2 - Сохранение паролей пользователей в секретницу
```bash
./mat_ch_cluster_population create-secrets ...
```
Принимает на вход сгенерированный на шаге 1 файл, создаёт из него секреты с пользователями и их паролями

В случае большого количества данных создаёт несколько секретов (рулится аргументом `--keys-per-secret`)

Доступ к секретам выдаётся пользователю robot-datalens-back@ и обладателям роли DevOps в группе https://abc.yandex-team.ru/services/ycdatalens/

### Шаг 3 - Сохранение данных о пользователях в базу пользователей
```bash
./mat_ch_cluster_population save-setup ...
```
Принимает на вход сгенерированный на шаге 1 файл, создаёт таблицу в базе и записывает в неё все пары база-пользователь

### Шаг 4 - Создание базы словарей
```bash
./mat_ch_cluster_population make-dict-db ...
```
Принимает входными параметрами данные кластера ClickHouse и секрет+ключ пароля от пользователя этого кластера в секретнице YaV

Создаёт базу и пользователя в кластере, на выходе возвращает имя созданной базы, пользователя и его пароль.

По умолчанию даёт доступ к базе всем созданным на кластере пользователям, но можно отключить это ключиком `--no-all-users-access`

### Шаг 5 - Сохранение данных о базе словарей в секретницу
```bash
./mat_ch_cluster_population add-dict-db-to-secret ...
```
Принимает входными параметрами данные кластера ClickHouse, имя и пароль созданного на предыдущем шаге пользователя и секрет+ключ записи с информацией о базах в секретнице YaV

Обновляет запись в секретнице, добавляя туда данные о новом кластере
