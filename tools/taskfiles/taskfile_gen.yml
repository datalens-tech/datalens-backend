version: '3'

vars:
  PACKAGE_NAME:
    sh: basename {{.USER_WORKING_DIR}}

tasks:
  formula-ref:
    dir: ../docker_build
    vars:
      CONFIG_VERSION: "{{.CLI_ARGS}}"
      OUTPUT_DIR: "../artifacts/doc_formula_ref/{{.CONFIG_VERSION}}"
    cmds:
      - rm -rf {{.OUTPUT_DIR}}
      - ./run-project-bake gen-formula-ref
        --set gen-formula-ref.args.OUTPUT_DIR={{.OUTPUT_DIR}}
        --set gen-formula-ref.args.CONFIG_VERSION={{.CONFIG_VERSION}}
        --set gen-formula-ref.output="type=local,dest={{.OUTPUT_DIR}}"
        --progress=plain
